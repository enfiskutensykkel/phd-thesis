\chapter{Flexible Device Sharing in PCIe Clusters using Device~Lending}
\label{paper:srmpds}
\paperthumb

\begin{description}
	\item[Authors:]
		\textbf{Jonas Markussen}, Lars Bj{\o}rlykke Kristiansen, H{\aa}kon Kvale Stensland,
		Friedrich Seifert, Carsten Griwodz, P{\aa}l Halvorsen.

	\item[Abstract:]
		Processing workloads may have very high \lgls{io}{IO} demands, exceeding the capabilities provided by resource
		virtualization and requiring direct access to the physical hardware.
		%
		For computers that are interconnected in \lgls{pcie}{PCI Express (PCIe)} networks, we have previously proposed 
		%
		Device Lending as a solution for assigning devices to remote hosts. In this paper, we
		explain how we have extended our implementation with support for the \lgls{kvm}{Linux Kernel-based Virtual
		Machine (KVM)} \gls{hypervisor}.
		Using our extended Device Lending, it becomes possible to dynamically ``pass through'' physical remote devices
		to \acrshort{vm} guests while still retaining the flexibility of virtualization, something that previously required
		extensive facilitation in both \gls{hypervisor} and device drivers in the form of \gls{paravirtualization}.
		%
		We have also improved our original implementation with support for interoperability between remote devices.
		We show that it is possible to use multiple devices residing in different hosts, while still achieving the same
		bandwidth and latency as native \lgls{pcie}{PCIe}, and without requiring any additional support in device drivers. 


	\item[Candidate's contributions:]
		Markussen came up with the idea for, designed and implemented the \acrshort{mdev}/\acrshort{kvm} extension to Device~Lending.
		%
		Markussen also implemented the mechanism for facilitating \acrshort{p2p} between devices in different lenders,
		including the mechanism for resolving \gls{io} addresses.
		%
		Markussen identified performance issues with the original Device~Lending implementation, 
		and he contributed to investigating several solutions for improving the data path performance.
		%
		Markussen wrote most of the text, and he designed and performed all the experiments, including writing the necessary performance benchmarking programs.

	\item[Published in:]
		\emph{Proceedings of the 47th International Conference on Parallel Processing Companion}.
		ICPP'18 Comp. ACM.
		%Part of \emph{the 17th International Workshop on Scheduling and Resource Management for Parallel and Distributed Systems}.
		August~2018, article~48, pp.~48:1--48:10.

	\item[DOI:] \href{https://doi.org/10.1145/3229710.3229759}{10.1145/3229710.3229759}

	\item[Contributed to:]
		\Cref{obj:distributed}, \cref{obj:transparent}, \cref{obj:performance}, \cref{obj:dynamic}, \cref{obj:experiments}.

\end{description}

\includepaper{papers/srmpds}{
	1, section, 1, Introduction, sec:srmpds-intro,
	2, section, 1, PCIe overview, sec:srmpds-pcie,
	2, subsection, 2, Memory addressing and forwarding, sec:srmpds-pcie-addr,
	2, subsection, 2, Virtualization support and pass-through, sec:srmpds-pcie-virt,
	2, subsection, 2, Non-transparent bridging, sec:srmpds-pcie-ntb,
	3, section, 1, Related work, sec:srmpds-rw,
	3, subsection, 2, Distributed IO using RDMA, sec:srmpds-rw-rdma,
	3, subsection, 2, Virtualization approaches, sec:srmpds-rw-virt,
	3, subsection, 2, Partitioning the fabric, sec:srmpds-rw-part,
	4, section, 1, Device Lending, sec:srmpds-lending,
	5, section, 1, Supporting virtual borrowers, sec:srmpds-mdev,
	6, section, 1, Multi-device interoperability, sec:srmpds-p2p,
	6, section, 1, Performance evaluation, sec:srmpds-eval,
	6, subsection, 2, IOMMU performance penalty, sec:srmpds-eval-iommu,
	7, subsection, 2, Pass-through comparison, sec:srmpds-eval-mdev,
	7, subsection, 2, Device-to-device evaluation, sec:srmpds-eval-p2p,
	%8, subsubsection, 3, Bandwidth, sec:srmpds-eval-p2p-bw,
	%8, subsubsection, 3, Latency, sec;srmpds-eval-p2p-lat,
	9, section, 1, Discussion and conclustion, sec:srmpds-concl
}
