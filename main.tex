% Suppress warnings about PDF version
\pdfminorversion=7
\documentclass[final,english,colophon]{phduio}
\usepackage{pdfpages}
\usepackage{phdstyle}
\usepackage[toc,acronym,seeautonumberlist]{glossaries}
\usepackage{glossaries-extra}
\usepackage{xparse}

% See the following link for documentation:
% https://github.com/uio-latex/phduio-article-based


% Can't ever have enough headlines
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}


\author{Jonas S{\ae}ther Markussen}
\title{SmartIO: Multi-host device sharing and memory disaggregation using PCIe non-transparent bridging}

\department{Department of Informatics}
\faculty{Faculty of Mathematics and Natural Sciences}

% Additional affiliations
\affiliation{
    Dolphin Interconnect Solutions
    \AND
    Simula Research Laboratory
}

% Request correct numbers from repro@uio.no
\ISSN{xxxx-xxxx}
\dissertationseries{xxxx}


% Include article (and add some blank pages)
\DeclareDocumentCommand{\includepaper}{ O{} m m}{
	%\includearticle[#1]{#2}{#3}
    \newpage\thispagestyle{empty}~\newpage\thispagestyle{empty}
}


% Thesis objectives
\newcounter{objective}
\newcommand{\objective}[1]{Objective~\refstepcounter{objective}\theobjective\label[objective]{obj:#1}}
\crefname{objective}{Objective}{Objectives}
\Crefname{objective}{Objective}{Objectives}


% Glossary stuff
\makeglossaries
\setabbreviationstyle[acronym]{long-short}
\def\myglossarytitle{Glossary}

% Some terms have both an acronym and needs a glossary entry
\DeclareDocumentCommand{\newdualentry}{ O{} O{} m m m m }{
	\newglossaryentry{gls-#3}{
        name={#5 (#4)},
		description={#6},#1
	}
    \makeglossaries
	\newglossaryentry{#3}{
		type=\acronymtype,
		name={#4},
		description={#5, \glsseeformat[\myglossarytitle:]{gls-#3}{}},
		long={#5\glsadd{gls-#3}},
        longplural={#5s\glsadd{gls-#3}},
		text={#4\glsadd{gls-#3}},
		short={#4\glsadd{gls-#3}},
		first={#5~(#4)\glsadd{gls-#3}},
        firstplural={#5s~(#4s)\glsadd{gls-#3}},#2
	}
    \makeglossaries
}


% Some terms need to refer something else in the dictionary
\DeclareDocumentCommand{\newlinkedacronym}{ O{} m m m m }{
    \newacronym[%
        first={#5~(#4)\glsadd{#2}},
        firstplural={#5s~(#4s)\glsadd{#2}},
        short={#4\glsadd{#2}},
        long={#5\glsadd{#2}},
        longplural={#5s\glsadd{#2}},#1
    ]{#3}{#4}{#5 \glsseeformat[\myglossarytitle:]{#2}{}}
    \makeglossaries
}

% Link to a glossary entry while using a custom text
\DeclareDocumentCommand{\lgls}{ m m }{\glsdisp{#1}{#2}\glsadd{#1}\ifglsentryexists{gls-#1}{\glsadd{gls-#1}}{}}

% Include glossary definitions
\makeglossaries
\input{glossary}
\makeglossaries

\begin{document}
	% Folios in Roman numerals, unnumbered chapters.
	\frontmatter 

	\uiotitle

	% Do some hyperref magic because we don't like
	% the template defaults
	\hypersetup{
		hidelinks, % no borders around links
		%colorlinks=false, % don't color links
		linktoc=all, % link to pages in TOC as well
	}

	% Prefacing sections
	%\include{sections/dedication}
	\include{sections/abstract}
	\include{sections/preface}

	% Paper list
	\cleartorecto
	\chapter{List of papers}
	\section*{\cref{paper:nossdav}}
	\fullcite{paper:nossdav}
	\section*{\cref{paper:mmsys}}
	\fullcite{paper:mmsys}
	\section*{\cref{paper:srmpds}}
	\fullcite{paper:srmpds}
	\section*{\cref{paper:cc}}
	\fullcite{paper:cc}
	\section*{\cref{paper:tocs}}
	\fullcite{paper:tocs}

	% We don't like uppercase in section titles
	\renewcommand{\listfigurename}{List of figures}
	\renewcommand{\listtablename}{List of tables}

	% Print all of the other lists
	\cleartorecto
	\tableofcontents
	\cleartorecto
	\listoffigures
	%\cleartorecto
	%\listoftables
	\cleartorecto
	\setglossarystyle{list}
    \printglossary[title=List of acronyms,type=\acronymtype]%,nonumberlist]

	% Folios in Arabic numerals, numbered chapters.
	\mainmatter

	\include{sections/introduction}
	\include{sections/smartio}
	\include{sections/conclusion}

	\setglossarystyle{altlist}
	\printglossary[type=main,title=\myglossarytitle]
	%\urlstyle{same} % Reset URL style for references
	\printbibliography[notkeyword=paper]
	
	% List of papers
	\paper % "Chapter" is renamed "Paper"
	%\paperpage % Similar to \part*{Papers}, but appears in TOC
	\part*{Published Papers}\addcontentsline{toc}{part}{Published Papers}
	\clearforchapter

	% Specify size of thumb indices
	\numberofpapers{5} 
	
	% We don't want to prefix section titles with the chapter number in the TOC for the papers
	\counterwithout{section}{chapter}

	\setcounter{section}{0}
	\include{sections/paper-nossdav}

	\setcounter{section}{0}
	\include{sections/paper-mmsys}

	\setcounter{section}{0}
	\include{sections/paper-srmpds}

	\setcounter{section}{0}
	\include{sections/paper-cc}

	\setcounter{section}{0}
	\include{sections/paper-tocs}

	% Restore section titles prefix the chapter number
	\counterwithin{section}{chapter}
\end{document}
